#!/usr/bin/env ruby
# frozen_string_literal: true

#
# This file was generated by Bundler.
#
# The application 'hanami' is installed as part of a gem, and
# this file is here to facilitate running it.
#

require "pathname"
ENV["BUNDLE_GEMFILE"] ||= File.expand_path("../../Gemfile",
  Pathname.new(__FILE__).realpath)

bundle_binstub = File.expand_path("../bundle", __FILE__)

if File.file?(bundle_binstub)
  if File.read(bundle_binstub, 300) =~ /This file was generated by Bundler/
    load(bundle_binstub)
  else
    abort("Your `bin/bundle` was not generated by Bundler, so this binstub cannot run.
Replace `bin/bundle` by running `bundle binstubs bundler --force`, then run this command again.")
  end
end

require "rubygems"
require "bundler/setup"

# REGISTER DB COMMANDS
#
# Hanami 2 will not have DB commands until persistence is added in version 2.1
# This code adds them manually, so that they are available via the ./bin/hanami
# command. e.g. ./bin/hanami db create
# These registrations can be removed when upgrading to hanami 2.1

require "hanami/cli"

require "hanami/cli/commands/app/db/create"
require "hanami/cli/commands/app/db/create_migration"
require "hanami/cli/commands/app/db/drop"
require "hanami/cli/commands/app/db/migrate"
require "hanami/cli/commands/app/db/setup"
require "hanami/cli/commands/app/db/reset"
require "hanami/cli/commands/app/db/rollback"
require "hanami/cli/commands/app/db/sample_data"
require "hanami/cli/commands/app/db/seed"
require "hanami/cli/commands/app/db/structure/dump"
require "hanami/cli/commands/app/db/version"

Hanami::CLI.register "db create", Hanami::CLI::Commands::App::DB::Create
Hanami::CLI.register "db create_migration", Hanami::CLI::Commands::App::DB::CreateMigration
Hanami::CLI.register "db drop", Hanami::CLI::Commands::App::DB::Drop
Hanami::CLI.register "db migrate", Hanami::CLI::Commands::App::DB::Migrate
Hanami::CLI.register "db setup", Hanami::CLI::Commands::App::DB::Setup
Hanami::CLI.register "db reset", Hanami::CLI::Commands::App::DB::Reset
Hanami::CLI.register "db rollback", Hanami::CLI::Commands::App::DB::Rollback
Hanami::CLI.register "db sample_data", Hanami::CLI::Commands::App::DB::SampleData
Hanami::CLI.register "db seed", Hanami::CLI::Commands::App::DB::Seed
Hanami::CLI.register "db structure dump", Hanami::CLI::Commands::App::DB::Structure::Dump
Hanami::CLI.register "db version", Hanami::CLI::Commands::App::DB::Version

Hanami::App.class_eval do
  def self.settings
    self["settings"]
  end
end

# END REGISTER DB COMMANDS

load Gem.bin_path("hanami-cli", "hanami")
